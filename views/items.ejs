<!-- Your Products Page (items.ejs) -->
<%- include('partials/top') -%>

<h1 style="color: #ffffff; font-weight: bold; text-align: center;">All Products!</h1>
<div class="product-container">
  <% items.forEach(item => { %>
    <div class="product">
      <div class="product-image">
        <img src="<%= item.image %>" alt="<%= item.name %>">
      </div>
      <div class="product-details">
        <h2><%= item.name %></h2>
        <br>
        <p style="    -webkit-text-stroke-width: 0.01px;    color:#007bff;    ">Price: $<%= item.price %></p>
        <!-- Add to Cart button with data attributes -->
        <button onclick="addToCart('<%= item.name %>', '<%= item.price %>', '<%= item.image %>')" style="color:rgb(0, 0, 0); background-color: rgb(255, 255, 255); -webkit-text-stroke-width: 0.0px; padding: 10px; font-weight: bold; box-shadow: 0 0 10px rgb(0, 0, 0);" class="add-to-cart" data-name="<%= item.name %>" data-price="<%= item.price %>" data-image="<%= item.image %>">
          Add to Cart
        </button>
      </div>
    </div>
  <% }); %>
</div>

<%- include('partials/style') -%>
<%- include('partials/footer') -%>



<style>
  /* Paste the provided CSS styles here */

  /* Additional styles for cart page */
  #cart-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    margin: 20px auto;
  }

  .cart-list {
    width: 100%;
    list-style: none;
    padding: 0;
  }

  .cart-item {
    width: 25%;
    background-color: #fff;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
    border-radius: 5px;
    margin: 10px;
    text-align: center;
    padding: 15px;
  }

  .product-image {
    width: 100%;
    height: 200px;
    overflow: hidden;
  }

  .product-image img {
    object-fit: cover;
    width: 100%;
    height: 100%;
  }

  .product-details {
    margin-top: 10px;
  }

  .product-details p {
    margin: 0;
  }

  .cart-empty {
    width: 100%;
    text-align: center;
    margin-top: 20px;
    color: #555;
  }
</style>

<script>
  function addToCart(name, price, image) {
    const item = {
      name: name,
      price: price,
      image: image
    };

    // Get Auth0 session ID
    const auth0SessionId = '<%= user.sid %>';

    // Get existing cart items from local storage using Auth0 session ID
    let cartItems = JSON.parse(localStorage.getItem(`cartItems_${auth0SessionId}`)) || [];

    // Check if the item is already in the cart
    const existingItemIndex = cartItems.findIndex(i => i.name === item.name);

    if (existingItemIndex !== -1) {
      // If the item is already in the cart, increase the quantity
      cartItems[existingItemIndex].quantity += 1;
    } else {
      // If the item is not in the cart, add it with a quantity of 1
      item.quantity = 1;
      cartItems.push(item);
    }

    // Update local storage with the updated cart using Auth0 session ID
    localStorage.setItem(`cartItems_${auth0SessionId}`, JSON.stringify(cartItems));

    // Alert the user about the successful addition
    alert('Item successfully added to the cart!');
  }
</script>